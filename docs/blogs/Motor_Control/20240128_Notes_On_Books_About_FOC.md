---
title: Notes on Books about FOC (2024)
permalink: /MC/notes_on_books_about_FOC/
---

# 2024年FOC相关书籍阅读笔记
之前关于FOC的学习过于碎片化，关于FOC讲解的很多概念都没有系统性的梳理，因此，我打算系统性的整理一下相关的书籍，并记录一下自己的理解。

## 一. 《无感FOC入门指南》，阳波，ISBN 978-7-03-075176-8
本书借阅于深圳科技图书馆，作者阳波，网名海绵宝宝。本书不连后记总共137页，分成5个章节。本书印刷质量较好，全书配彩图。本书作者示例使用的是英飞凌的XMC4100单片机，目前比较昂贵。预计不会使用此硬件制作电路板，但是仍然会理解此芯片配置以方便后续硬件设计。本书理论核心是第4章，大概35页内容。本书编程实践是第5章，大概25页。前三章讲学习路径和软硬件准备。本书重点在于讲解无感FOC.

### 1.1 第一章/概述
文中重点提到了AN1078这份FOC领域广为人知的应用笔记。还提到了BLHeli这款开源飞控算法以及VESC项目。

文中探讨了无感方波控制算法中换相问题。重点提到多数使用的是反电动势过零点的换相方式在低速时因为信噪比而失效，因此多数低速启动使用的是开环强托（盲启）方式。文中还提到一种通过磁链信号的换相方式。

文中简单交待了无感FOC算法基本包含三部分：坐标系转换，电流调节和位置估计。FOC控制不想方波控制那样有浮空相，因此不能直接检测反电动势过零点。因此产生了两类位置估算算法。
* 第一类算法是由反电动势或磁链信号得到位置信息，此方法性能良好但在极低速或静止很难持续跟踪信号。常用的策略有三种：
    1. 间接得到反电动势信号。通过建立电机数学模型，通过补偿算法去贴近真实的电机运动。通过对两相正交坐标系中两个反电动势信号做反正切运算结算出连续位置信号。（参见AN1078）
    2. 第二种方法也是使用反电动势信号。但是这种方法是采用电机稳态运行是，d轴（仅限于永磁电机，感应电机不可用）的反电动势始终为0这个事实，通过锁相环控制其始终为0.这样就可以通过检测d轴反电动势是否为0来调节给定速度，进而对速度积分来获取位置信息。（本书使用这种办法）
    3. 第三种不使用反电动势信号，而是使用磁链信号。对于磁链信号有3种结算方法：对正交磁链信号求反正切，获取位置；利用外插法通过锁相环获取位置（适合低速，不适合高动态响应场合）;直接估算三项静止坐标系中的转子磁链（但用的不多）。
* 第二类算法其实就是高频注入算法。它利用dq轴电感差异来做检测。但是如果dq轴的电感差异不大（比如电动自行车、滑板车的轮毂电机它的dq轴电感差异不大）时，这种方法就无能为力。

### 1.2 第二章/硬件准备
这一篇中列举了做电机控制器开发常用的硬件仪器：稳压电源，示波器，万用表，LCR电桥，转速计，电流钳表。另外还列举了焊接需要的仪器和用品，比如电烙铁，热风枪，低温锡膏，吸锡带，洗板水等。调试使用的J-Link和USB隔离器。当然还有无刷电机以及控制板。

本章还对硬件原理图有比较详细的介绍。本电路板使用三个半桥驱动芯片（NCP5160B）配合六个MOSFET（IRFR3709Z）来驱动无刷电机。为了配合NCP5160B工作，还使用了一个电荷泵芯片LM2665来提升电压到10V.电路搭配4个采样电阻和运放TSV914（运放采用开尔文接法）实现对三个下桥臂采样和母线采样。（为什么要采用母线采样，而不是通过计算的方式？我的理解是它在后面使用了电压比较器直接控制TRAP,这样比软件安全。）此外还有其它各种辅助电路，这里就不一一列举。

### 1.3 第三章/软件准备
这一章分成了三个部分。第一部分讲了keil的配置，并制作了一个示例程序演示了怎么编译和烧写。第二部分讲了[J-Scope](https://www.segger.com/products/debug-probes/j-link/tools/j-scope/)的使用。因为本教程使用的是JLINK,所以可以使用这种办法。Segger官方有更全面的介绍，可以参考[这里](https://wiki.segger.com/UM08028_J-Scope)。文中没有介绍[RTT](https://www.segger.com/products/debug-probes/j-link/technology/about-real-time-transfer/),如果你想知道怎么使用RTT，也可以查看相关链接。第三部分各个功能模块的编程和测试。

* 关于ADC采样： 对于只有一个ADC模块的单片机，只能一次转换各个通道;对于有2个或者更多ADC模块的单片机，可以同时触发几个ADC模块同步进行采样。当然，有的单片机具有2个甚至4个采样保持电路，可以同时触发几个采样保持电路同时采集多个通道的电压。然后由一个ADC模块逐一转换。同步触发采样的信号是最好的。












## 二. 《深入理解无刷直流电机矢量控制技术》，上官致远/张健， ISBN 978-7-03-065510-3
本书借阅于深圳科技图书馆，作者上官致远和张健。本书正文总共118页。分为10个章节。本书印刷质量较好，全书配彩图。本书示例用到的是STM32F40X系列单片机。目前此单片机价格适中。考虑到对ST单片机相对更加熟练，可能会在后期使用STM32单片机制作自己的开发板。本书从电机原理、方波控制原理、矢量控制原理、SVPWM原理和测速原理、电机参数测量等多方面讲解了无刷电机的控制。相比于《无感FOC入门指南》本书的理论讲解更加细致，有助于理解矢量控制的原理。编程实践部分较少，但也有一些示例代码。本书对无感FOC稍有讲解，但是重点在于传统的FOC技术。
